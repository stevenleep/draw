# 浏览器绘画扩展 - 简化架构图

## 🎯 核心概念

这是一个**Chrome浏览器扩展**，可以在任意网页上进行绘画和标注。核心思想是在网页上覆盖一个透明的Canvas层，用户在这个层上进行绘画操作。

## 🏗️ 简化架构图

```
┌─────────────────────────────────────────────────────────────────┐
│                    Chrome Extension                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────┐ │
│  │   Background    │    │   Content       │    │   Web Page  │ │
│  │     Script      │◄──►│     Script      │───►│  (Target)   │ │
│  │                 │    │                 │    │             │ │
│  │ • 处理图标点击   │    │ • 主控制器      │    │ • 原网页内容 │ │
│  │ • 消息传递      │    │ • 绘画管理器    │    │ • Canvas覆盖 │ │
│  │ • 脚本注入      │    │ • 工具栏管理    │    │             │ │
│  └─────────────────┘    └─────────────────┘    └─────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🔧 核心组件

```
┌─────────────────────────────────────────────────────────────────┐
│                        Content Script                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │                   ContentController                         │ │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │ │
│  │  │DrawingManager│◄──►│ToolbarManager│◄──►│MessageHandler│    │ │
│  │  │             │    │             │    │             │    │ │
│  │  │ • 管理Canvas  │    │ • 创建工具栏  │    │ • 处理消息   │    │ │
│  │  │ • 初始化引擎  │    │ • 工具切换    │    │ • 状态同步   │    │ │
│  │  │ • 状态管理    │    │ • 属性面板    │    │             │    │ │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🎨 绘画引擎

```
┌─────────────────────────────────────────────────────────────────┐
│                        Drawing Engine                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────────────────────────────────────────────────────────┐ │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │ │
│  │  │DrawingState │◄──►│ToolManager  │◄──►│DrawingRenderer│    │ │
│  │  │             │    │             │    │             │    │ │
│  │  │ • 存储对象   │    │ • 管理工具   │    │ • 渲染画布   │    │ │
│  │  │ • 撤销重做   │    │ • 工具切换   │    │ • 实时预览   │    │ │
│  │  │ • 选择状态   │    │ • 插件系统   │    │ • 选择框     │    │ │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    │ │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐    │ │
│  │  │TextEditing  │    │DrawingEvent │    │Canvas       │    │ │
│  │  │State        │    │Handler      │    │Overlay      │    │ │
│  │  │             │    │             │    │             │    │ │
│  │  │ • 文本编辑   │    │ • 事件处理   │    │ • 透明覆盖   │    │ │
│  │  │ • 输入状态   │    │ • 鼠标键盘   │    │ • 高z-index  │    │ │
│  │  │ • 焦点管理   │    │ • 触摸支持   │    │ • 全屏覆盖   │    │ │
│  │  └─────────────┘    └─────────────┘    └─────────────┘    │ │
│  └─────────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🛠️ 工具插件系统

```
┌─────────────────────────────────────────────────────────────────┐
│                        Tool Plugins                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│  │PenTool  │ │Rectangle│ │Circle   │ │TextTool │ │ArrowTool│ │
│  │         │ │Tool     │ │Tool     │ │         │ │         │ │
│  │ • 自由画 │ │ • 矩形   │ │ • 圆形   │ │ • 文本   │ │ • 箭头   │ │
│  │ • 手绘   │ │ • 拖拽   │ │ • 拖拽   │ │ • 点击   │ │ • 拖拽   │ │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│  │LineTool │ │HandDrawn│ │Eraser   │ │Highlight│ │StarTool │ │
│  │         │ │Tool     │ │Tool     │ │Tool     │ │         │ │
│  │ • 直线   │ │ • 手绘   │ │ • 橡皮擦 │ │ • 高亮   │ │ • 星形   │ │
│  │ • 拖拽   │ │ • 粗糙   │ │ • 擦除   │ │ • 半透明 │ │ • 拖拽   │ │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐ │
│  │Triangle │ │Select   │ │         │ │         │ │         │ │
│  │Tool     │ │Tool     │ │         │ │         │ │         │ │
│  │ • 三角形 │ │ • 选择   │ │         │ │         │ │         │ │
│  │ • 拖拽   │ │ • 移动   │ │         │ │         │ │         │ │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘ └─────────┘ │
└─────────────────────────────────────────────────────────────────┘
```

## 🔄 工作流程

```
1. 用户点击扩展图标
   ↓
2. Background Script 发送消息给 Content Script
   ↓
3. ContentController 激活绘画模式
   ↓
4. DrawingManager 创建 Canvas 覆盖层
   ↓
5. ToolbarManager 创建工具栏
   ↓
6. 用户选择工具并开始绘画
   ↓
7. DrawingEngine 处理绘画事件
   ↓
8. DrawingRenderer 实时渲染到 Canvas
   ↓
9. 用户完成绘画，对象保存到 DrawingState
```

## 📊 数据流

```
用户交互 → 工具栏 → 工具管理器 → 绘画引擎 → 状态管理 → 渲染器 → Canvas
    ↑                                                              ↓
    └─────────────────── 实时反馈 ─────────────────────────────────┘
```

## 🎯 关键特性

### ✅ 已实现功能
- **多工具支持**: 12种不同的绘画工具
- **实时绘画**: 流畅的绘画体验
- **撤销重做**: 完整的操作历史
- **对象选择**: 选择和编辑已绘制的对象
- **文本编辑**: 支持文本输入和编辑
- **属性面板**: Figma风格的属性设置
- **工具栏**: 可拖拽的工具栏
- **背景保存**: 可以保存包含原网页的截图

### 🔧 技术特点
- **插件化架构**: 易于添加新工具
- **模块化设计**: 清晰的职责分离
- **状态管理**: 完整的状态追踪
- **事件系统**: 统一的事件处理
- **Canvas优化**: 高效的渲染性能

## 🏆 架构优势

1. **可扩展性**: 插件化设计，易于添加新功能
2. **可维护性**: 模块化架构，代码结构清晰
3. **性能优化**: Canvas渲染，事件委托
4. **用户体验**: 实时反馈，流畅交互
5. **兼容性**: 支持所有现代浏览器

这个架构设计展现了现代Web扩展开发的最佳实践，既保证了功能的完整性，又确保了代码的可维护性和可扩展性。 